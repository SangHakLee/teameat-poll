# LOVABLE.md

이 파일은 Lovable을 통해 개발된 "회식투표" 앱의 개발 과정과 기능을 설명합니다.

## 프로젝트 탄생 배경

**10년차 직장인의 회식 투표 자동화 여정**

회사 생활 10년 차인데 아직도 회식 투표를 만들고 있습니다. 구글 시트에 이름 넣고, 날짜 적고, O/X 드롭다운 만들고, COUNTIF 함수 지정하고... 제일 귀찮은 건 며칠이 무슨 요일인지 일일이 수정하는 거였어요. 그래서 그냥 만들었습니다.

**만든이**: [SangHakLee](https://github.com/SangHakLee)

## 개발 플랫폼

이 앱은 **Lovable** (AI 기반 웹 개발 플랫폼)을 사용하여 개발되었습니다. 사용자의 자연어 요청을 통해 반복적으로 기능을 추가하고 개선했습니다.

- Lovable 프로젝트 템플릿: `new_style_vite_react_shadcn_ts_testing_2026-01-08`
- 약 160개 이상의 커밋을 통한 점진적 개선
- 2026년 1월 8일 ~ 1월 29일 (약 3주간 개발)

## 핵심 기능

### 1. 투표 생성 및 관리
- **날짜 선택**: 달력 UI로 여러 날짜 선택
- **공휴일/주말 제외**: 대한민국 공휴일 자동 표시 및 제외 옵션
- **참여자 관리**: 참여자 추가/수정/삭제
- **5자리 공유 코드**: 영대소문자+숫자 조합 (예: `aBc12`)

### 2. 블라인드 투표 시스템
- 다른 참여자의 투표 결과를 숨김
- **모든 참여자가 투표 완료하면 결과 공개**
- Edge Function으로 투표 데이터 마스킹 (`get-poll-votes`)
- "눈치 보고 투표 안하는 것 방지"가 목적 (보안 목적 아님)

### 3. 인증 및 권한 관리
- **구글 소셜 로그인** (Supabase Auth)
- **비로그인 사용자**:
  - 투표 생성 가능
  - 참여코드만 알면 누구나 투표 수정 가능
  - 마감일 +10일 후 자동 삭제 (`DAYS_AFTER_DEADLINE_TO_DELETE`)
- **로그인 사용자**:
  - 투표 소유권 획득
  - 최대 5개 투표 생성 가능 (`MAX_POLLS_PER_USER`)
  - 제목, 설명, 모든 옵션 수정 가능
  - 영구 보관 (자동 삭제 안됨)

### 4. 투표 옵션
- **비밀번호 보호**: 비밀번호를 아는 사람만 참여
- **누구나 수정 가능**: 참여코드만 알면 날짜/참여자 수정 가능
- **마감일 설정**: 시간 단위까지 설정 (분은 없음)
- **자동 삭제 알림**: 마감일 정보와 함께 삭제 예정일 표시

### 5. 투표 결과
- **최다 득표 날짜 하이라이트**: 1-3순위 금은동 트로피 표시
- **투표 완료 여부 표시**: 각 참여자별 "완" 뱃지
- **한마디 기능**: 참여자별 코멘트 (말풍선 이모지로 표시)
- **시트 복사**: 구글 시트 형식으로 복사 가능 (O/X 드롭다운 포함)
- **이미지 저장**: html2canvas로 투표 결과 이미지 생성

### 6. AI 일정 요약 (최신 기능)
- **AI 기반 회식 공지 생성**: `generate-poll-summary` Edge Function
- 외부 AI 모델 사용 (`teamet-poll-notice` via Ollama)
- 비동기 처리로 즉시 응답 (pending → completed/failed)
- 투표 제목, 최적 날짜, 장소/설명 기반 자동 요약

### 7. 실시간 동기화
- Supabase Realtime으로 `polls`, `votes` 테이블 구독
- 다른 참여자가 투표하면 자동 새로고침
- 동시 수정 감지 (날짜/참여자 수정 시)

## 디자인 시스템 (소주병 테마 🍺)

**컬러 팔레트**:
- **초록색** (`#24752c`): 전체 테마, 소주병 색상
- **파란색** (`#00b3ed`): 강조 포인트, 버튼, 투표 완료 표시
- **빨간색** (`#be1e2b`): 위험 알림, 마감일 경고

**타이포그래피**:
- 커스텀 폰트: GabiaDunn (전체 적용)
- 이모지 활용: 섹션별 시각적 구분 (📅 날짜 선택, 👥 참여자 등)

**UI/UX 원칙**:
- "생성형 AI 느낌" 제거 → 직관적이고 간결한 디자인
- 중앙 정렬 중심 레이아웃
- 모바일 우선 설계
- 명시적인 버튼과 상태 표시

## 개발 과정 하이라이트

### Phase 1: 기본 투표 시스템 (1월 8-14일)
- SPA 구조로 마이그레이션
- 달력 기반 날짜 선택
- 참여자 입력 시스템 (버그 수정 여러 번: "김씨" → "김씨", "씨" 중복 추가 이슈)
- 투표하기/결과보기 탭 분리

### Phase 2: 인증 및 권한 (1월 15-17일)
- 구글 소셜 로그인 구현
- 투표 소유권 시스템
- "로그인하면 투표 저장 가능" 프롬프트 모달
- 7일간 보지 않기 (localStorage)
- 로그인 후 자동 투표 생성 UX

### Phase 3: UI/UX 대폭 개선 (1월 18-22일)
- 소주병 컬러 테마 적용
- 폰트 변경 (GabiaDunn)
- "생성형 AI 느낌" 제거 작업
- 투표 정보 모달 추가
- 참여자 검색 기능 (LIKE 검색)
- 공유 링크 자동 파싱

### Phase 4: 고급 기능 (1월 19-21일)
- 블라인드 투표 (Edge Function)
- 투표 수정 기능 및 변경 로그
- Admin 페이지 (`/sanghaklee-poll-good`)
- 비밀번호 On/Off 토글

### Phase 5: SEO 및 최적화 (1월 20-21일)
- 메타 태그 최적화
- Open Graph, Twitter Card
- Google Analytics 연동 (`G-CL0YCJV5G8`)
- robots.txt, sitemap.xml
- JSON-LD 스키마
- LLM용 정적 페이지 (`/llm.html`)
- Favicon (소주병 + 체크마크)

### Phase 6: AI 요약 및 최종 폴리싱 (1월 27-29일)
- AI 일정 요약 기능 추가
- 비동기 AI 요약 처리
- 투표 결과 테이블 스타일 개선
- Sticky 헤더 z-index 버그 수정
- 마감 후 수정 비활성화

## 주요 기술적 도전 과제

### 1. 참여자 입력 버그
**문제**: "김씨" 입력 시 "김씨", "씨" 두 개가 추가됨
**원인**: 한글 입력 IME의 compositionend 이벤트 처리
**해결**: 여러 커밋에 걸쳐 입력 핸들링 로직 개선

### 2. 날짜 정규화
**문제**: ISO 형식과 `yyyy-MM-dd` 형식 혼재로 투표 매칭 실패
**해결**: `normalizeDate()` 함수로 모든 날짜 일관성 유지

### 3. 블라인드 투표 구현
**문제**: 클라이언트에서 직접 쿼리하면 RLS로도 데이터 숨기기 어려움
**해결**: Edge Function에서 마감일 체크 후 마스킹 (`{ __masked: true }`)

### 4. 로그인 후 상태 유지
**문제**: 투표 생성 중 로그인 하면 새로고침으로 데이터 손실
**해결**: localStorage로 폼 상태 저장 + 로그인 후 자동 투표 생성

### 5. 동시 수정 문제
**문제**: 여러 사용자가 동시에 참여자/날짜 수정 시 충돌
**해결**: Supabase Realtime으로 실시간 감지 + 수정 중 알림 (부분 구현)

## 테스트 전략

- **Vitest + jsdom**: UI/UX 테스트 코드 추가
- 참여자 입력 버그 방지 테스트 (`participantInput.test.ts`)
- UX 테스트 (`uiux.test.ts`)

## 배포

- **URL**: https://poll.yessir.dev
- **Supabase Project**: tkhftcnwuwlerbzfooon
- **Lovable 자동 배포**: Git push 시 자동 반영

## 주요 파일 구조

```
src/
├── components/
│   ├── VoteCreationForm.tsx      # 투표 생성 폼 (localStorage 저장)
│   ├── VoteParticipation.tsx     # 투표 참여 UI
│   ├── VoteResult.tsx            # 투표 결과 및 트로피 표시
│   ├── EditPollModal.tsx         # 투표 수정 (소유자 전용)
│   ├── LoginPromptModal.tsx      # 로그인 유도 모달
│   └── MyPollsTab.tsx            # 내가 만든/참여한 투표 목록
├── hooks/
│   ├── usePoll.ts                # 투표 데이터 + Realtime 구독
│   └── usePollActions.ts         # 투표 생성/수정/삭제 액션
├── lib/
│   ├── pollId.ts                 # 5자리 ID 생성
│   ├── pollCleanup.ts            # 자동 삭제 로직
│   └── holidays.ts               # 대한민국 공휴일 데이터
└── pages/
    ├── Index.tsx                 # 메인 페이지 (만들기/참여하기/내투표)
    ├── VotePage.tsx              # 투표하기/결과보기 (탭)
    └── AdminPage.tsx             # 관리자 페이지

supabase/
├── functions/
│   ├── get-poll-votes/           # 블라인드 투표 데이터 마스킹
│   ├── generate-poll-summary/    # AI 일정 요약
│   └── verify-admin/             # 관리자 인증
└── migrations/                   # 5개 마이그레이션 파일
```

## 사용자 페르소나: CSO (Chief Soju Officer)

"당신은 CSO (Chief Soju Officer)입니다. 멋진 회식 투표를 만들어보세요 🍺"

**푸터 메시지**: "CSO가 회식 일정을 책임집니다"

## 향후 개선 사항 (대화에서 논의된 것들)

- [ ] 구글 시트 자동 생성 (복사 대신 SSO 연동)
- [ ] 참여자별 투표 이력 추적
- [ ] 웹소켓 기반 동시 수정 잠금
- [ ] 투표 템플릿 기능 (O/X 빠른 선택)
- [ ] 카카오톡 공유 개선

## 메타 정보

- **개발 기간**: 2026-01-08 ~ 2026-01-29 (약 3주)
- **총 커밋 수**: 160+ (Lovable 자동 커밋 포함)
- **개발 방식**: Lovable AI 대화형 개발
- **대화 로그**: `대화.md` 참조
- **주요 기술**: React, TypeScript, Supabase, Vite, shadcn/ui, TanStack Query
